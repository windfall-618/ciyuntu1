<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨èƒ½å½¢çŠ¶è¯äº‘ç”Ÿæˆå™¨ (8ç§å½¢çŠ¶)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js"></script>
    <style>
        :root {
            --primary: #6c5ce7; /* æ”¹ç”¨æ›´ä¼˜é›…çš„ç´«è‰²ç³» */
            --secondary: #a29bfe;
            --bg: #dfe6e9;
            --panel: #ffffff;
            --text: #2d3436;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            margin: 0; padding: 0;
            background-color: var(--bg);
            display: flex; height: 100vh; overflow: hidden; color: var(--text);
        }

        /* å·¦ä¾§é…ç½®æ  */
        .sidebar {
            width: 350px;
            background-color: var(--panel);
            padding: 25px;
            box-shadow: 5px 0 20px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; gap: 18px; z-index: 10;
            overflow-y: auto;
        }
        
        h2 { margin: 0 0 10px 0; font-size: 1.6rem; color: var(--primary); display: flex; align-items: center; gap: 10px;}
        .subtitle { font-size: 0.85rem; color: #888; margin-top: -10px; margin-bottom: 5px; }

        label { font-size: 0.95rem; font-weight: 700; margin-bottom: 8px; display: block; color: #555;}
        
        textarea {
            width: 100%; height: 140px; padding: 12px;
            border: 2px solid #eee; border-radius: 8px;
            resize: none; font-family: inherit; box-sizing: border-box;
            font-size: 0.9rem; transition: border 0.3s;
            background: #fafafa;
        }
        textarea:focus { border-color: var(--primary); outline: none; background: #fff;}
        
        /* å½¢çŠ¶é€‰æ‹©æ¡†æ ·å¼ä¼˜åŒ– */
        select#shapeSelect {
            border: 2px solid var(--primary);
            background-color: #f3f0ff;
            font-weight: bold;
            color: var(--primary);
        }
        
        select, input[type="range"] {
            width: 100%; padding: 10px; border: 2px solid #eee;
            border-radius: 8px; background: white; cursor: pointer; box-sizing: border-box;
            font-size: 1rem;
        }
        input[type="color"] { width: 100%; height: 45px; padding: 4px; border: 2px solid #eee; border-radius: 8px; cursor: pointer;}

        .btn-group { display: flex; gap: 15px; margin-top: auto; padding-top: 20px;}
        button {
            flex: 1; padding: 15px; border: none; border-radius: 10px;
            cursor: pointer; font-weight: 700; font-size: 1rem; color: white;
            transition: all 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
        button:disabled { opacity: 0.7; cursor: not-allowed; transform: none!important; }
        .btn-gen { background: linear-gradient(135deg, var(--primary), #8e44ad); }
        .btn-down { background: linear-gradient(135deg, #00b894, #55efc4); }

        /* å³ä¾§ç”»å¸ƒ */
        .main-content {
            flex: 1; padding: 30px;
            display: flex; justify-content: center; align-items: center;
            background-image: radial-gradient(#b2bec3 2px, transparent 2px);
            background-size: 30px 30px;
        }
        #canvas-wrapper {
            width: 100%; height: 100%; max-width: 900px; max-height: 900px;
            background: white; border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
            position: relative; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }
        #placeholder-text { position: absolute; color: #ccc; font-size: 1.5rem; font-weight: bold; opacity: 0.6;}
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>ğŸ¨ å¤šå½¢çŠ¶è¯äº‘</h2>
        <div class="subtitle">å·²è§£é” 8 ç§å‡ ä½•å½¢çŠ¶</div>
        
        <div>
            <label>1. è¾“å…¥æ–‡æœ¬ (è‡ªåŠ¨æ™ºèƒ½åˆ†è¯):</label>
            <textarea id="textInput" placeholder="è¾“å…¥å¤§é‡æ–‡æœ¬...">åˆ›æ–° ç§‘æŠ€ æœªæ¥ æ¢¦æƒ³ åšæŒ å‹‡æ°” æ¢ç´¢ æ™ºæ…§ åˆä½œ å…±èµ¢ æŒ‘æˆ˜ æœºé‡ çªç ´ æé™ å·…å³° è£è€€ è¾‰ç…Œ ä¼ å¥‡ æ°¸æ’ å“è¶Š éå‡¡ æè‡´ å®Œç¾ è‰ºæœ¯ çµæ„Ÿ åˆ›æ„ è®¾è®¡ ç¾å­¦ æ½®æµ æ—¶å°š ç»å…¸ ä¼ æ‰¿ æ–‡åŒ– å†å² æ–‡æ˜ å®‡å®™ æ˜Ÿè¾° å¤§æµ· å±±å· æ²³æµ è‡ªç„¶ ç”Ÿå‘½ å¥‡è¿¹ å¸Œæœ› å…‰æ˜ æ¸©æš– å®ˆæŠ¤ é™ªä¼´ æˆé•¿ èœ•å˜ æ–°ç”Ÿ åŠ›é‡ ä¿¡ä»°</textarea>
        </div>

        <div>
            <label style="color: var(--primary);">2. é€‰æ‹©å½¢çŠ¶:</label>
            <select id="shapeSelect">
                <option value="cardioid" selected>â¤ï¸ å¿ƒå½¢ (Heart)</option>
                <option value="circle">â˜ï¸ äº‘å½¢/åœ†å½¢ (Cloud/Circle)</option>
                <option value="star">â­ æ˜Ÿå½¢ (Star)</option>
                <option value="triangle">â–² ä¸‰è§’å½¢ (Triangle)</option>
                <option value="triangle-forward">â–¶ï¸ æ’­æ”¾é”® (Play)</option>
                <option value="pentagon">ğŸ  äº”è¾¹å½¢ (Pentagon)</option>
                <option value="diamond">â™¦ï¸ è±å½¢ (Diamond)</option>
                <option value="square">â¹ï¸ æ­£æ–¹å½¢ (Square)</option>
            </select>
        </div>

        <div>
            <label>3. å¯†åº¦ä¸å¤§å°:</label>
            <input type="range" id="sizeRange" min="5" max="40" value="20">
        </div>

        <div>
            <label>4. èƒŒæ™¯é¢œè‰²:</label>
            <input type="color" id="bgColor" value="#ffffff">
        </div>

        <div class="btn-group">
            <button class="btn-gen" onclick="startGenerate()">ğŸš€ ç”Ÿæˆ</button>
            <button class="btn-down" onclick="downloadImg()">ğŸ–¼ï¸ ä¸‹è½½</button>
        </div>
    </div>

    <div class="main-content">
        <div id="canvas-wrapper">
            <span id="placeholder-text">ç­‰å¾…æŒ‡ä»¤...</span>
            <canvas id="myCanvas"></canvas>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('myCanvas');
        const wrapper = document.getElementById('canvas-wrapper');
        const btnGen = document.querySelector('.btn-gen');
        const placeholder = document.getElementById('placeholder-text');

        function resize() {
            canvas.width = wrapper.clientWidth;
            canvas.height = wrapper.clientHeight;
        }
        window.addEventListener('resize', resize);

        // æ–‡æœ¬å¤„ç†ï¼šä¿æŒé«˜å¯†åº¦åˆ‡åˆ†
        function processText(text) {
            let clean = text.replace(/[^\w\u4e00-\u9fa5]/g, ' ');
            let words = [];
            let rawParts = clean.split(/\s+/);
            
            rawParts.forEach(part => {
                if (part.length > 0 && part.length <= 4) {
                    words.push(part);
                } else if (part.length > 4) {
                    // é•¿è¯åˆ‡åˆ†ï¼Œä¿è¯å¡«å……ç‡
                    for (let i = 0; i < part.length - 1; i += 2) words.push(part.substr(i, 2));
                }
            });

            const freq = {};
            words.forEach(w => freq[w] = (freq[w] || 0) + 1);
            // å¢åŠ åˆ° 600 ä¸ªè¯ï¼Œä¿è¯æ­£æ–¹å½¢ç­‰å¤§é¢ç§¯å½¢çŠ¶èƒ½å¡«æ»¡
            return Object.entries(freq).sort((a,b) => b[1] - a[1]).slice(0, 600);
        }

        function startGenerate() {
            btnGen.textContent = 'âš¡ è®¡ç®—ä¸­...';
            btnGen.disabled = true;
            placeholder.style.display = 'none';

            // 3ç§’é˜²å¡æ­»æ¢å¤
            setTimeout(() => {
                btnGen.textContent = 'ğŸš€ ç”Ÿæˆ';
                btnGen.disabled = false;
            }, 3000);

            resize();
            
            const text = document.getElementById('textInput').value;
            const list = processText(text);
            const shape = document.getElementById('shapeSelect').value;
            const userScale = document.getElementById('sizeRange').value;
            const bg = document.getElementById('bgColor').value;

            const ctx = canvas.getContext('2d');
            ctx.fillStyle = bg;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (list.length < 10) {
                alert("æ–‡æœ¬å¤ªå°‘ï¼Œæ— æ³•æ’‘èµ·å½¢çŠ¶ï¼");
                return;
            }

            const baseDimension = Math.min(canvas.width, canvas.height);
            const baseScale = baseDimension / 1000; 

            WordCloud(canvas, {
                list: list,
                shape: shape,
                // ç½‘æ ¼å¤§å°ï¼šæ­£æ–¹å½¢éœ€è¦æ›´å¯†çš„ç½‘æ ¼ï¼Œå…¶ä»–å½¢çŠ¶é€‚ä¸­
                gridSize: Math.max(Math.floor(baseDimension / 350), 2),
                weightFactor: function (size) {
                    // å¤§å°è®¡ç®—å…¬å¼ï¼šæ ¹æ®ç”¨æˆ·æ»‘å—åŠ¨æ€è°ƒæ•´
                    return (2 + Math.log(size + 1) * userScale * 1.5) * baseScale;
                },
                fontFamily: '"PingFang SC", "Microsoft YaHei", sans-serif',
                // ä½¿ç”¨å†·è‰²è°ƒ+ç´«è‰²è°ƒçš„éšæœºè‰²
                color: function() {
                    const hue = Math.floor(Math.random() * 360);
                    return `hsl(${hue}, 60%, 45%)`; 
                },
                backgroundColor: bg,
                rotateRatio: 0.2, // 20% æ¦‚ç‡æ—‹è½¬
                rotationSteps: 2,
                shrinkToFit: true,
                drawOutOfBound: false,
                wordcloudfinished: function() {
                     btnGen.textContent = 'âœ… å®Œæˆï¼';
                     setTimeout(() => {
                        if (!btnGen.disabled) btnGen.textContent = 'ğŸš€ ç”Ÿæˆ';
                     }, 1500);
                }
            });
        }

        function downloadImg() {
            const temp = document.createElement('canvas');
            temp.width = canvas.width * 2;
            temp.height = canvas.height * 2;
            const ctx = temp.getContext('2d');
            ctx.scale(2, 2);
            ctx.fillStyle = document.getElementById('bgColor').value;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(canvas, 0, 0);
            
            const shapeName = document.getElementById('shapeSelect').value;
            const a = document.createElement('a');
            a.download = `wordcloud-${shapeName}-${Date.now()}.png`;
            a.href = temp.toDataURL('image/png');
            a.click();
        }

        // åˆå§‹è¿è¡Œ
        setTimeout(() => { resize(); startGenerate(); }, 600);
    </script>
</body>
</html>
